(function(e){function t(t){for(var r,a,c=t[0],s=t[1],u=t[2],d=0,v=[];d<c.length;d++)a=c[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&v.push(i[a][0]),i[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(v.length)v.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==i[s]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},i={app:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push(["b8ef","chunk-vendors"]),n()})({"70cc":function(e,t,n){"use strict";n("fe8b")},a40c:function(e,t,n){"use strict";n("d658")},b8ef:function(e,t,n){"use strict";n.r(t),n.d(t,"store",(function(){return X})),n.d(t,"$vm",(function(){return le}));n("5cfb");var r=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"content"},[n("div",{staticClass:"name"},[e._v("2048")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.data.dimension,expression:"data.dimension"}],staticClass:"dimension",attrs:{type:"number"},domProps:{value:e.data.dimension},on:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.restart(t)},input:function(t){t.target.composing||e.$set(e.data,"dimension",t.target.value)}}}),n("div",{staticClass:"name"},[e._v(e._s(e.data.stepsLength))]),n("div",{staticClass:"btn",on:{click:e.restart}},[e._v("restart")])]),n("div",{ref:"box",staticClass:"box",attrs:{id:"box"}},[n("div",{attrs:{id:"pixi"}})]),n("game-over",{directives:[{name:"show",rawName:"v-show",value:e.data.isGameOver,expression:"data.isGameOver"}]})],1)},o=[],a=(n("8e6e"),n("ac6a"),n("456d"),n("bd86")),c=(n("7514"),n("8449"),n("6c7b"),n("22a2")),s=n("2ef0"),u=n.n(s),l=n("c8b5"),d=n.n(l);function v(e){var t=new d.a.Manager(e);return t.add(new d.a.Swipe),t}function p(e){var t={};return t.code=e,t.release=void 0,t.upHandler=function(e){e.keyCode===t.code&&t.release&&t.release(),e.preventDefault()},window.addEventListener("keyup",t.upHandler.bind(t),!1),t}function f(e,t){return Math.floor(Math.random()*(t-e+1))+e}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return+parseFloat(e.toPrecision(t))}function g(e,t){return{y:_.floor(e/t),x:e%t}}function y(e,t){for(var n=[[e[0]]],r=1;r<e.length;r++){if(!e[r])break;_.last(_.last(n))[t]!==e[r][t]?n.push([e[r]]):_.last(n).push(e[r])}return n}function h(e,t){var n=0,r=1,i=setInterval((function(){n+=.09*t*r,e.scale.set(m(n),m(n)),e.visible=!0,m(n)>=1.3*t&&(r=-1),m(n)<=t&&-1===r&&(e.scale.set(t,t),clearInterval(i))}),12)}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=window.devicePixelRatio,O=0,j=new c["a"]({width:O,height:O}),S={},D={initView:C};function W(e){j.resize();var t=e.dimension,n=e.margin;e.speed,e.currentScore,e.highestScore,e.isGameOver;S=x({correction:0,isInitRandomSprite:!1,isMoving:!1,spriteWidth:m(O/t-2*n),probability:90,sprites:[],mergeSprites:[],moveSteps:[],textures:[],chessBgStage:[],moveDirection:0,rectContainer:null,spriteContainer:null,left:p(37),up:p(38),right:p(39),down:p(40),moveSprite:$,initView:C,drawRectSprite:B},e),O=.9*e.width*w,e.margin=n*w;var r=t;S.spriteWidth=m(O/r-2*n),S.correction=S.spriteWidth/2,e.speed=m(S.spriteWidth/5),S.isInitRandomSprite=!1,S.moveSteps=[],S.sprites=[],S.textures=[],S.chessBgStage=[],S.moveDirection=0,S.chessBgStage=u.a.fill(Array(r*r),0,0,r*r)}function C(e){W(e),j=new c["a"]({width:O,height:O}),document.getElementById("pixi").replaceWith(j.view),j.renderer.view.id="pixi",j.renderer.backgroundColor=12299680,j.renderer.view.style.verticalAlign="top",j.renderer.view.style.transform="scale(".concat(1/w,")"),j.renderer.view.style.position="absolute",j.renderer.view.style.left="4%",j.renderer.view.style.transformOrigin="0 0",j.renderer.view.style.border="".concat(S.margin,"px solid #bbada0"),S.rectContainer=new c["b"],S.spriteContainer=new c["b"],j.loader.add([{name:"numberJson",url:"./game-img/2048/number.json"}]).on("progress",N).load((function(){M(),P(e),j.ticker.add(R)}))}function P(e){k(S.chessBgStage),q(e),F(),S.isInitRandomSprite=!1,F()}function M(){S.textures=j.loader.resources["numberJson"].textures}function k(e){e.forEach((function(e,t){E(g(t,S.dimension))})),j.stage.addChild(S.rectContainer),j.stage.addChild(S.spriteContainer),S.sprites=j.stage.children[1].children}function E(e){var t=e.x,n=e.y,r=new c["c"],i=m(S.margin+(S.spriteWidth+2*S.margin)*t),o=m(S.margin+(S.spriteWidth+2*S.margin)*n);r.beginFill(13418675),r.drawRoundedRect(i,o,S.spriteWidth,S.spriteWidth,20),r.endFill(),S.rectContainer.addChild(r)}function B(e){var t=e.x,n=e.y,r=e.value,i=m(S.margin+(S.spriteWidth+2*S.margin)*t+S.correction),o=m(S.margin+(S.spriteWidth+2*S.margin)*n+S.correction);I({x:i,y:o,value:r})}function I(e){var t=e.x,n=e.y,r=e.value,i=e.v,o=void 0===i?{vx:0,vy:0}:i,a=new c["d"](S.textures["n".concat(r,".png")]);a.x=m(t),a.x1=2*a.x,a.vx=o.vx,a.vy=o.vy,a.y=m(n),a.y1=2*a.y,a.value=r,a.isNew=!0,a.visible=!1,a.width=S.spriteWidth,a.height=S.spriteWidth,a.anchor.set(.5,.5),a.aid=u.a.uniqueId(),S.spriteContainer.addChild(a),h(a,a.scale.x)}function N(e,t){console.log("loading: "+t.url),console.log("progress: "+e.progress+"%")}function G(e){if(2===e){var t=u.a.sortBy(S.sprites,["y","x"]);return y(t,"y")}if(4===e){var n=u.a.sortBy(S.sprites,["y",function(e){return-e.x}]);return y(n,"y")}if(8===e){var r=u.a.sortBy(S.sprites,["x","y"]);return y(r,"x")}if(16===e){var i=u.a.sortBy(S.sprites,["x",function(e){return-e.y}]);return y(i,"x")}}function R(){if(S.sprites.every((function(e){return 0===e.vx&&0===e.vy})))return S.isMoving=!1,void(S.sprites.every((function(e){return Math.abs(e.x-e.x1)<1&&Math.abs(e.y-e.y1)<1}))||(F(),J()&&(S.isGameOver=!0)));var e=m(O-S.spriteWidth-S.margin+S.correction),t=2===S.moveDirection||8===S.moveDirection?1:-1;G(S.moveDirection).forEach((function(n){for(var r=0;r<n.length;r++){var i=n[r];if(2===S.moveDirection&&i.x<=S.margin+S.correction)i.x=S.margin+S.correction,i.vx=0;else if(4===S.moveDirection&&i.x>=e)i.x=e,i.vx=0;else if(16===S.moveDirection&&i.y>=e)i.y=e,i.vy=0;else if(8===S.moveDirection&&i.y<=S.margin+S.correction)i.y=S.margin+S.correction,i.vy=0;else{var o=n[r-1];if(o){var a=!1;if(a=2===S.moveDirection?i.x+i.vx<=o.x+(S.spriteWidth+S.margin)*t:8===S.moveDirection?i.y+i.vy<=o.y+(S.spriteWidth+S.margin)*t:4===S.moveDirection?i.x+i.vx>=o.x+(S.spriteWidth+S.margin)*t:i.y+i.vy>=o.y+(S.spriteWidth+S.margin)*t,!o.vx&&!o.vy&&a&&(i.value!==o.value||o.isNew||i.isNew)){2===S.moveDirection&&(i.x=m(o.x+S.spriteWidth+2*S.margin),i.vx=0),4===S.moveDirection&&(i.x=m(o.x-S.spriteWidth-2*S.margin),i.vx=0),8===S.moveDirection&&(i.y=m(o.y+S.spriteWidth+2*S.margin),i.vy=0),16===S.moveDirection&&(i.y=m(o.y-S.spriteWidth-2*S.margin),i.vy=0);continue}var c=(2===S.moveDirection||4===S.moveDirection)&&Math.abs(o.x-i.x)<=S.speed||(8===S.moveDirection||16===S.moveDirection)&&Math.abs(o.y-i.y)<=S.speed;o.value!==i.value||!c||o.isNew||i.isNew||(console.log("will be push in hitMerge arr s1:".concat(i.aid,", x: ").concat(i.x,", y: ").concat(i.y,", value: ").concat(i.value,", vx: ").concat(i.vx,", vy: ").concat(i.vy)),console.log("will be push in hitMerge arr s2:".concat(o.aid,", x: ").concat(o.x,", y: ").concat(o.y,", value: ").concat(o.value,", vx: ").concat(o.vx,", vy: ").concat(o.vy)),T(o,i),r++)}i.x+=i.vx,i.y+=i.vy}}})),S.mergeSprites.forEach((function(e){console.log("foreach hitMerge arr s1:".concat(e.s1.aid,", x: ").concat(e.s1.x,", y: ").concat(e.s1.y,", value: ").concat(e.s1.value)),console.log("foreach hitMerge arr s2:".concat(e.s2.aid,", x: ").concat(e.s2.x,", y: ").concat(e.s2.y,", value: ").concat(e.s2.value)),T(e.s1,e.s2)})),S.mergeSprites=[]}function F(){if(!S.isInitRandomSprite){S.isInitRandomSprite=!0,console.log("数组长度：".concat(S.sprites.length));var e=f(0,S.dimension*S.dimension-1);S.randomSpriteIndex=e,console.log("初始随机位置：".concat(e)),e=A(e),console.log("去重后随机位置：".concat(e));var t=f(0,100)>S.probability?4:2;B(x(x({},g(e,S.dimension)),{},{value:t}))}}function A(e){return V(e)?(e=++e%(S.dimension*S.dimension),A(e)):e}function V(e){var t=g(e,S.dimension),n=t.x,r=t.y;console.log("随机位置对应的x：".concat(n,", y: ").concat(r));var i=m(S.margin+(S.spriteWidth+2*S.margin)*n+S.correction),o=m(S.margin+(S.spriteWidth+2*S.margin)*r+S.correction);return S.sprites.find((function(e){return Math.abs(e.x-i)<1&&Math.abs(e.y-o)<1}))}function J(){if(S.sprites.length===S.dimension*S.dimension){var e=u.a.sortBy(S.sprites,["y","x"]),t=L(e,"y");return t||(e=u.a.sortBy(S.sprites,["x","y"]),t=L(e,"x")),!t}return!1}function L(e,t){return e.find((function(n,r){return!!e[r+1]&&(n[t]===e[r+1][t]&&n.value===e[r+1].value)}))}function $(e,t){S.isMoving||(S.isMoving=!0,S.isInitRandomSprite=!1,S.moveDirection=e,S.moveSteps.push(e),S.sprites.forEach((function(e){return e.isNew=!1})),console.warn("方向：".concat(e)),S.sprites.forEach((function(t){t.isNew=!1,t.x1=t.x,t.y1=t.y,2===e&&(t.vx=-S.speed),4===e&&(t.vx=S.speed),8===e&&(t.vy=-S.speed),16===e&&(t.vy=S.speed)})),t.stepsLength++)}function T(e,t){console.log("hitMerge-s1: aid: ".concat(e.aid,", x: ").concat(e.x,", y: ").concat(e.y,", value: ").concat(e.value)),console.log("hitMerge-s2: aid: ".concat(t.aid,", x: ").concat(t.x,", y: ").concat(t.y,", value: ").concat(t.value)),t.value=2*t.value,t.isNew=!0,t.texture=S.textures["n".concat(t.value,".png")],e.visible=!1;var n=j.stage.children[1].removeChild(e);console.log("removeChild-s1: aid: ".concat(n&&n.aid))}function q(e){v(document.getElementById("pixi")).on("swipe",(function(t){$(t.offsetDirection,e)})),S.left.release=function(){$(2,e)},S.right.release=function(){$(4,e)},S.down.release=function(){$(16,e)},S.up.release=function(){$(8,e)}}var H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"game-over"},[n("div",{staticClass:"text"},[e._v("game over!")]),n("div",{staticClass:"btn",on:{click:e.newGame}},[e._v("new game")])])},z=[],K=n("2f62"),Q=n("7024");r["a"].use(K["a"]);var U={dimension:4,margin:6,speed:10,currentScore:0,highestScore:0,isGameOver:!1,stepsLength:0},X=new K["a"].Store({state:{data:Object(s["cloneDeep"])(U)},getters:{getField:Q["a"]},mutations:{updateField:Q["c"]}}),Y={name:"GameOver",props:{},methods:{newGame:function(){X.width=document.getElementById("app").clientWidth,D.initView()}}},Z=Y,ee=(n("a40c"),n("2877")),te=Object(ee["a"])(Z,H,z,!1,null,"72be6538",null),ne=te.exports;function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oe={name:"Games-2048",components:{GameOver:ne},data:function(){return{}},computed:ie({},Object(Q["b"])(["data"])),mounted:function(){this.data.width=document.getElementById("box").clientWidth,D.initView(this.data)},methods:{restart:function(){this.data=Object(s["mergeWith"])(Object(s["cloneDeep"])(U),{dimension:this.data.dimension}),this.data.width=document.getElementById("box").clientWidth,D.initView(this.data)}}},ae=oe,ce=(n("d599"),n("70cc"),Object(ee["a"])(ae,i,o,!1,null,"2b89ea51",null)),se=ce.exports,ue=n("9483");Object(ue["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),r["a"].config.productionTip=!1;var le=new r["a"]({store:X,devtools:!0,render:function(e){return e(se)},el:"#app"})},d599:function(e,t,n){"use strict";n("ed80")},d658:function(e,t,n){},ed80:function(e,t,n){},fe8b:function(e,t,n){}});
//# sourceMappingURL=app.0.1.0.1611055948941.js.map