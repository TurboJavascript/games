(function(e){function t(t){for(var i,a,c=t[0],s=t[1],u=t[2],d=0,v=[];d<c.length;d++)a=c[d],r[a]&&v.push(r[a][0]),r[a]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);l&&l(t);while(v.length)v.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={app:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="games/2048/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push(["b8ef","chunk-vendors"]),n()})({"0dc8":function(e,t,n){"use strict";var i=n("1c2e"),r=n.n(i);r.a},"1c2e":function(e,t,n){},a40c:function(e,t,n){"use strict";var i=n("d658"),r=n.n(i);r.a},b8ef:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("097d");var i=n("3a34"),r=n.n(i),o=(n("5cfb"),n("2b0e")),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"content"},[n("div",{staticClass:"name"},[e._v("2048")]),n("div",{staticClass:"menu"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.data.dimension,expression:"data.dimension"}],staticClass:"dimension",attrs:{type:"number"},domProps:{value:e.data.dimension},on:{input:function(t){t.target.composing||e.$set(e.data,"dimension",t.target.value)}}}),n("div",{staticClass:"btn",on:{click:e.restart}},[e._v("new game")])])]),n("div",{ref:"box",staticClass:"box",attrs:{id:"box"}},[n("div",{attrs:{id:"pixi"}})]),n("game-over",{directives:[{name:"show",rawName:"v-show",value:e.data.isGameOver,expression:"data.isGameOver"}]})],1)},c=[],s=n("c8b5"),u=n.n(s);function l(e){var t=new u.a.Manager(e);return t.add(new u.a.Swipe),t}n("7514");var d=n("be94"),v=(n("8449"),n("ac6a"),n("6c7b"),n("22a2")),f=n("2ef0"),p=n.n(f),h={};function m(){h.dimension=4,h.margin=6,h.speed=10,h.currentScore=0,h.highestScore=0,h.isGameOver=!1}m();var y=h;function g(e){var t={};return t.code=e,t.release=void 0,t.upHandler=function(e){e.keyCode===t.code&&t.release&&t.release(),e.preventDefault()},window.addEventListener("keyup",t.upHandler.bind(t),!1),t}function x(e,t){return Math.floor(Math.random()*(t-e+1))+e}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return+parseFloat(e.toPrecision(t))}function b(e,t){return{y:_.floor(e/t),x:e%t}}function S(e,t){for(var n=[[e[0]]],i=1;i<e.length;i++){if(!e[i])break;_.last(_.last(n))[t]!==e[i][t]?n.push([e[i]]):_.last(n).push(e[i])}return n}function W(e,t){var n=0,i=1,r=setInterval(function(){n+=.09*t*i,e.scale.set(w(n),w(n)),e.visible=!0,w(n)>=1.3*t&&(i=-1),w(n)<=t&&-1===i&&(e.scale.set(t,t),clearInterval(r))},12)}var C=window.devicePixelRatio,D=y.dimension,M=y.margin,O=y.speed,E=0,B=new v["a"]({width:E,height:E}),I={correction:0,isInitRandomSprite:!1,isMoving:!1,spriteWidth:w(E/D-2*M),probability:90,sprites:[],mergeSprites:[],textures:[],chessBgStage:[],moveDirection:0,moveSteps:[],rectContainer:null,spriteContainer:null,left:g(37),up:g(38),right:g(39),down:g(40),moveSprite:K,initView:N,drawRectSprite:V},j={initView:N};function k(){m(),E=.9*y.width*C,M*=C;var e=D;I.spriteWidth=w(E/e-2*M),I.correction=I.spriteWidth/2,y.speed=w(I.spriteWidth/5),I.isInitRandomSprite=!1,I.moveSteps=[],I.sprites=[],I.textures=[],I.chessBgStage=[],I.moveDirection=0,I.chessBgStage=p.a.fill(Array(e*e),0,0,e*e)}function N(){k(),B=new v["a"]({width:E,height:E}),document.getElementById("pixi").replaceWith(B.view),B.renderer.view.id="pixi",B.renderer.backgroundColor=12299680,B.renderer.view.style.verticalAlign="top",B.renderer.view.style.transform="scale(".concat(1/C,")"),B.renderer.view.style.transformOrigin="0 0",B.renderer.view.style.border="".concat(M,"px solid #bbada0"),I.rectContainer=new v["b"],I.spriteContainer=new v["b"];var e=!1;B.loader.add([{name:"numberJson",url:"".concat(e?"":"/games/".concat(Object({NODE_ENV:"production",BASE_URL:"games/2048/"}).SITE),"/game-img/2048/number.json")}]).on("progress",J).load(function(){G(),R(),B.ticker.add($)})}function R(){P(I.chessBgStage),X(),q(),I.isInitRandomSprite=!1,q()}function G(){I.textures=B.loader.resources["numberJson"].textures}function P(e){e.forEach(function(e,t){A(b(t,D))}),B.stage.addChild(I.rectContainer),B.stage.addChild(I.spriteContainer),I.sprites=B.stage.children[1].children}function A(e){var t=e.x,n=e.y,i=new v["c"],r=w(M+(I.spriteWidth+2*M)*t),o=w(M+(I.spriteWidth+2*M)*n);i.beginFill(13418675),i.drawRoundedRect(r,o,I.spriteWidth,I.spriteWidth,20),i.endFill(),I.rectContainer.addChild(i)}function V(e){var t=e.x,n=e.y,i=e.value,r=w(M+(I.spriteWidth+2*M)*t+I.correction),o=w(M+(I.spriteWidth+2*M)*n+I.correction);F({x:r,y:o,value:i})}function F(e){var t=e.x,n=e.y,i=e.value,r=e.v,o=void 0===r?{vx:0,vy:0}:r,a=new v["d"](I.textures["n".concat(i,".png")]);a.x=w(t),a.x1=2*a.x,a.vx=o.vx,a.vy=o.vy,a.y=w(n),a.y1=2*a.y,a.value=i,a.isNew=!0,a.visible=!1,a.width=I.spriteWidth,a.height=I.spriteWidth,a.anchor.set(.5,.5),a.aid=p.a.uniqueId(),I.spriteContainer.addChild(a),W(a,a.scale.x)}function J(e,t){console.log("loading: "+t.url),console.log("progress: "+e.progress+"%")}function T(e){if(2===e){var t=p.a.sortBy(I.sprites,["y","x"]);return S(t,"y")}if(4===e){var n=p.a.sortBy(I.sprites,["y",function(e){return-e.x}]);return S(n,"y")}if(8===e){var i=p.a.sortBy(I.sprites,["x","y"]);return S(i,"x")}if(16===e){var r=p.a.sortBy(I.sprites,["x",function(e){return-e.y}]);return S(r,"x")}}function $(){if(I.sprites.every(function(e){return 0===e.vx&&0===e.vy}))return I.isMoving=!1,void(I.sprites.every(function(e){return Math.abs(e.x-e.x1)<1&&Math.abs(e.y-e.y1)<1})||(q(),U()&&(y.isGameOver=!0)));var e=w(E-I.spriteWidth-M+I.correction),t=2===I.moveDirection||8===I.moveDirection?1:-1;T(I.moveDirection).forEach(function(n){for(var i=0;i<n.length;i++){var r=n[i];if(2===I.moveDirection&&r.x<=M+I.correction)r.x=M+I.correction,r.vx=0;else if(4===I.moveDirection&&r.x>=e)r.x=e,r.vx=0;else if(16===I.moveDirection&&r.y>=e)r.y=e,r.vy=0;else if(8===I.moveDirection&&r.y<=M+I.correction)r.y=M+I.correction,r.vy=0;else{var o=n[i-1];if(o){var a=!1;if(a=2===I.moveDirection?r.x+r.vx<=o.x+(I.spriteWidth+M)*t:8===I.moveDirection?r.y+r.vy<=o.y+(I.spriteWidth+M)*t:4===I.moveDirection?r.x+r.vx>=o.x+(I.spriteWidth+M)*t:r.y+r.vy>=o.y+(I.spriteWidth+M)*t,!o.vx&&!o.vy&&a&&(r.value!==o.value||o.isNew||r.isNew)){2===I.moveDirection&&(r.x=w(o.x+I.spriteWidth+2*M),r.vx=0),4===I.moveDirection&&(r.x=w(o.x-I.spriteWidth-2*M),r.vx=0),8===I.moveDirection&&(r.y=w(o.y+I.spriteWidth+2*M),r.vy=0),16===I.moveDirection&&(r.y=w(o.y-I.spriteWidth-2*M),r.vy=0);continue}var c=(2===I.moveDirection||4===I.moveDirection)&&Math.abs(o.x-r.x)<=O||(8===I.moveDirection||16===I.moveDirection)&&Math.abs(o.y-r.y)<=O;o.value!==r.value||!c||o.isNew||r.isNew||(console.log("will be push in hitMerge arr s1:".concat(r.aid,", x: ").concat(r.x,", y: ").concat(r.y,", value: ").concat(r.value,", vx: ").concat(r.vx,", vy: ").concat(r.vy)),console.log("will be push in hitMerge arr s2:".concat(o.aid,", x: ").concat(o.x,", y: ").concat(o.y,", value: ").concat(o.value,", vx: ").concat(o.vx,", vy: ").concat(o.vy)),Q(o,r),i++)}r.x+=r.vx,r.y+=r.vy}}}),I.mergeSprites.forEach(function(e){console.log("foreach hitMerge arr s1:".concat(e.s1.aid,", x: ").concat(e.s1.x,", y: ").concat(e.s1.y,", value: ").concat(e.s1.value)),console.log("foreach hitMerge arr s2:".concat(e.s2.aid,", x: ").concat(e.s2.x,", y: ").concat(e.s2.y,", value: ").concat(e.s2.value)),Q(e.s1,e.s2)}),I.mergeSprites=[]}function q(){if(!I.isInitRandomSprite){I.isInitRandomSprite=!0,console.log("数组长度：".concat(I.sprites.length));var e=x(0,D*D-1);I.randomSpriteIndex=e,console.log("初始随机位置：".concat(e)),e=H(e),console.log("去重后随机位置：".concat(e));var t=x(0,100)>I.probability?4:2;V(Object(d["a"])({},b(e,D),{value:t}))}}function H(e){return L(e)?(e=++e%(D*D),H(e)):e}function L(e){var t=b(e,D),n=t.x,i=t.y;console.log("随机位置对应的x：".concat(n,", y: ").concat(i));var r=w(M+(I.spriteWidth+2*M)*n+I.correction),o=w(M+(I.spriteWidth+2*M)*i+I.correction);return I.sprites.find(function(e){return Math.abs(e.x-r)<1&&Math.abs(e.y-o)<1})}function U(){if(I.sprites.length===D*D){var e=p.a.sortBy(I.sprites,["y","x"]),t=z(e,"y");return t||(e=p.a.sortBy(I.sprites,["x","y"]),t=z(e,"x")),!t}return!1}function z(e,t){return e.find(function(n,i){return!!e[i+1]&&(n[t]===e[i+1][t]&&n.value===e[i+1].value)})}function K(e){I.isMoving||(I.isMoving=!0,I.isInitRandomSprite=!1,I.moveDirection=e,I.moveSteps.push(e),I.sprites.forEach(function(e){return e.isNew=!1}),console.warn("方向：".concat(e)),I.sprites.forEach(function(t){t.isNew=!1,t.x1=t.x,t.y1=t.y,2===e&&(t.vx=-O),4===e&&(t.vx=O),8===e&&(t.vy=-O),16===e&&(t.vy=O)}))}function Q(e,t){console.log("hitMerge-s1: aid: ".concat(e.aid,", x: ").concat(e.x,", y: ").concat(e.y,", value: ").concat(e.value)),console.log("hitMerge-s2: aid: ".concat(t.aid,", x: ").concat(t.x,", y: ").concat(t.y,", value: ").concat(t.value)),t.value=2*t.value,t.isNew=!0,t.texture=I.textures["n".concat(t.value,".png")],e.visible=!1;var n=B.stage.children[1].removeChild(e);console.log("removeChild-s1: aid: ".concat(n&&n.aid))}function X(){l(document.getElementById("pixi")).on("swipe",function(e){K(e.offsetDirection)}),I.left.release=function(){K(2)},I.right.release=function(){K(4)},I.down.release=function(){K(16)},I.up.release=function(){K(8)}}var Y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"game-over"},[n("div",{staticClass:"text"},[e._v("game over!")]),n("div",{staticClass:"btn",on:{click:e.newGame}},[e._v("new game")])])},Z=[],ee={name:"GameOver",props:{},methods:{newGame:function(){y.width=document.getElementById("app").clientWidth,j.initView()}}},te=ee,ne=(n("a40c"),n("2877")),ie=Object(ne["a"])(te,Y,Z,!1,null,"72be6538",null);ie.options.__file="gameover.vue";var re=ie.exports,oe={name:"Games-2048",components:{GameOver:re},data:function(){return{data:y}},mounted:function(){y.width=document.getElementById("box").clientWidth,j.initView()},methods:{restart:function(){y.width=document.getElementById("box").clientWidth,j.initView()}}},ae=oe,ce=(n("d599"),n("0dc8"),Object(ne["a"])(ae,a,c,!1,null,"5a740d05",null));ce.options.__file="App.vue";var se=ce.exports,ue=n("9483");Object(ue["a"])("".concat("games/2048/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),o["a"].config.productionTip=!1,new r.a,new o["a"]({render:function(e){return e(se)}}).$mount("#app")},d599:function(e,t,n){"use strict";var i=n("ed80"),r=n.n(i);r.a},d658:function(e,t,n){},ed80:function(e,t,n){}});
//# sourceMappingURL=app.179697ce.js.map